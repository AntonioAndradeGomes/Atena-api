generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role{
  ADMIN
  STUDENT
  PROFESSOR
  ACADEMIC_CENTER
} 

model User{

  id                          String @id @default(uuid())
  name                        String
  mail                        String @unique
  password                    String 
  roles                       Role[]  
  registration                String?
  code                        String?
  caInitDate                  DateTime?
  caEndDate                   DateTime?
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  academicCenterId            String?
  academicCenter              User? @relation("AcademicCenterUser", fields: [academicCenterId], references: [id])
  userAcademicCenter          User? @relation("AcademicCenterUser")

  @@map("users")
}

model Event{
  id                          String @id @default(uuid())
  title                       String
  description                 String?
  isActive                    Boolean
  difficultyLevel             Int
  initDate                    DateTime
  endDate                     DateTime?
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt()

  class                       Class @relation(fields: [classId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  classId                     String
  
  @@map("events")
}

model Discipline{
  id                          String    @id @default(uuid())
  code                        String    @unique
  name                        String
  initials                    String
  courseLoad                  Int
  createdAt                   DateTime  @default(now())
  updatedAt                   DateTime  @updatedAt


  classes                     Class[] @relation(name: "classNeedsToHaveADiscipline")

  @@map("discipline")
}

model Class{
  id                          String @id @default(uuid())
  name                        String
  academicYear                String
  period                      String
  isRegularClass              Boolean
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  discipline                  Discipline @relation(name: "classNeedsToHaveADiscipline", fields: [disciplineId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  disciplineId                String

  events                      Event[]

  students                    StudentOnClasses[]

  @@map("class")
}

model AccessCode{
  id                          String @id @default(uuid())
  code                        String @unique
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
  expiredAt                   DateTime
}

model StudentOnClasses{
  studentId                   String
  classId                     String
  
  class                       Class @relation(fields: [classId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
  @@id([studentId, classId])
}

model UserToken{
  id                          String @id @default(uuid())
  token                       String
 
  userId                      String
  createdAt                   DateTime @default(now())
  updateAt                    DateTime @updatedAt

  @@map("user_token")
}


model Request{
  id                          String @id @default(uuid())
  description                 String
  mail                        String
  isCheck                     Boolean  @default(false)
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  @@map("requests")
}

